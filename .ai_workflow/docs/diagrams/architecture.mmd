graph TB
    subgraph "🎮 User Interface Layer"
        CLI[ai-dev CLI<br/>15 Commands]
        NL[Natural Language<br/>manager.md]
        API[API Interface<br/>Future]
    end
    
    subgraph "⚙️ Command Processing Layer"
        CP[Command Parser<br/>Route & Validate]
        VL[Validation Layer<br/>Security Check]
        RT[Router<br/>Workflow Selection]
    end
    
    subgraph "🔄 Workflow Engine"
        WE[Workflow Executor<br/>Core Engine]
        SM[State Manager<br/>Persistence]
        EM[Error Manager<br/>Recovery]
        CB[Circuit Breaker<br/>Protection]
    end
    
    subgraph "📋 Core Workflows"
        subgraph "🚀 Setup (5 workflows)"
            S1[01_start_setup]
            S2[02_configure]
            S3[03_create_structure]
            S4[04_validate]
            S5[05_finalize]
        end
        
        subgraph "💼 Execution (8 workflows)"
            E1[PRD Generation]
            E2[PRP Creation]
            E3[Task Processing]
            E4[Run Management]
        end
        
        subgraph "🛡️ Security (6 workflows)"
            M1[Input Validation]
            M2[Security Audit]
            M3[Permission Check]
            M4[Sanitization]
        end
        
        subgraph "🔄 Common (12 workflows)"
            C1[Error Handling]
            C2[Circuit Breaker]
            C3[Self Protection]
            C4[User Escalation]
        end
    end
    
    subgraph "🤖 GitHub Actions (22 actions)"
        subgraph "📊 Daily Monitoring"
            GA1[Performance<br/>6 AM UTC]
            GA2[Health Check<br/>8 AM UTC]
            GA3[Integration Tests<br/>10 AM UTC]
            GA4[Documentation<br/>11 AM UTC]
        end
        
        subgraph "📈 Analytics"
            GA5[Usage Analytics<br/>Weekly]
            GA6[Changelog<br/>On Changes]
            GA7[Update Distribution<br/>Real-time]
        end
    end
    
    subgraph "💾 Data Layer"
        CFG[Configuration<br/>Settings & Env]
        STATE[State Storage<br/>Session Data]
        LOGS[Logging<br/>Metrics & Errors]
        CACHE[Cache<br/>Performance]
    end
    
    subgraph "🔗 External Integration"
        GH[GitHub API<br/>Actions & Issues]
        EXT[External Tools<br/>Adapters]
        FEED[Feedback System<br/>Community]
    end
    
    %% Main Flow
    CLI --> CP
    NL --> CP
    CP --> VL
    VL --> RT
    RT --> WE
    WE --> SM
    WE --> EM
    WE --> CB
    
    %% Workflow Connections
    WE --> S1
    WE --> E1
    WE --> M1
    WE --> C1
    
    %% Data Connections
    SM --> CFG
    SM --> STATE
    EM --> LOGS
    WE --> CACHE
    
    %% External Connections
    WE --> GH
    WE --> EXT
    EM --> FEED
    
    %% GitHub Actions
    GA1 --> LOGS
    GA2 --> STATE
    GA3 --> LOGS
    GA4 --> CFG
    GA5 --> LOGS
    GA6 --> GH
    GA7 --> GH
    
    %% Styling
    classDef userLayer fill:#e3f2fd,stroke:#1976d2
    classDef processLayer fill:#e8f5e8,stroke:#388e3c
    classDef workflowLayer fill:#fff3e0,stroke:#f57c00
    classDef actionLayer fill:#fce4ec,stroke:#c2185b
    classDef dataLayer fill:#f3e5f5,stroke:#7b1fa2
    classDef extLayer fill:#e0f2f1,stroke:#00796b
    
    class CLI,NL,API userLayer
    class CP,VL,RT,WE,SM,EM,CB processLayer
    class S1,S2,S3,S4,S5,E1,E2,E3,E4,M1,M2,M3,M4,C1,C2,C3,C4 workflowLayer
    class GA1,GA2,GA3,GA4,GA5,GA6,GA7 actionLayer
    class CFG,STATE,LOGS,CACHE dataLayer
    class GH,EXT,FEED extLayer
