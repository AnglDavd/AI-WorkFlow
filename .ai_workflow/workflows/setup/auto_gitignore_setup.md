# Auto GitIgnore Setup for User Projects

## Purpose
Automatically generate and maintain comprehensive .gitignore files for user projects based on detected technologies and framework best practices.

## Philosophy
Zero-friction repository management - users get clean repositories automatically without manual configuration.

## Execution Context
- **Integration**: Called during project setup and periodically
- **Approach**: Technology detection + smart .gitignore generation
- **User Impact**: Transparent, automatic, no manual intervention required

## Auto GitIgnore Generation Workflow

```bash
#!/bin/bash

# Auto GitIgnore Setup for User Projects
echo "🛡️  Setting up automatic repository cleanliness..."

# Configuration
PROJECT_DIR="${1:-.}"
GITIGNORE_FILE="$PROJECT_DIR/.gitignore"
BACKUP_SUFFIX="_backup_$(date +%Y%m%d_%H%M%S)"
FRAMEWORK_DIR=".ai_workflow"

# === DETECT PROJECT TECHNOLOGIES ===
echo "🔍 Detecting project technologies..."

declare -A DETECTED_TECHS
TECH_CONFIDENCE=()

# JavaScript/Node.js Detection
if [[ -f "$PROJECT_DIR/package.json" ]] || [[ -f "$PROJECT_DIR/yarn.lock" ]] || [[ -f "$PROJECT_DIR/pnpm-lock.yaml" ]]; then
    DETECTED_TECHS[nodejs]=true
    TECH_CONFIDENCE+=("Node.js: HIGH (package files found)")
fi

# Python Detection
if [[ -f "$PROJECT_DIR/requirements.txt" ]] || [[ -f "$PROJECT_DIR/setup.py" ]] || [[ -f "$PROJECT_DIR/pyproject.toml" ]] || [[ -f "$PROJECT_DIR/Pipfile" ]]; then
    DETECTED_TECHS[python]=true
    TECH_CONFIDENCE+=("Python: HIGH (dependency files found)")
fi

# Java Detection
if [[ -f "$PROJECT_DIR/pom.xml" ]] || [[ -f "$PROJECT_DIR/build.gradle" ]] || [[ -f "$PROJECT_DIR/gradle.properties" ]]; then
    DETECTED_TECHS[java]=true
    TECH_CONFIDENCE+=("Java: HIGH (build files found)")
fi

# Go Detection
if [[ -f "$PROJECT_DIR/go.mod" ]] || [[ -f "$PROJECT_DIR/go.sum" ]]; then
    DETECTED_TECHS[go]=true
    TECH_CONFIDENCE+=("Go: HIGH (go.mod found)")
fi

# Rust Detection
if [[ -f "$PROJECT_DIR/Cargo.toml" ]] || [[ -f "$PROJECT_DIR/Cargo.lock" ]]; then
    DETECTED_TECHS[rust]=true
    TECH_CONFIDENCE+=("Rust: HIGH (Cargo files found)")
fi

# PHP Detection
if [[ -f "$PROJECT_DIR/composer.json" ]] || [[ -f "$PROJECT_DIR/composer.lock" ]]; then
    DETECTED_TECHS[php]=true
    TECH_CONFIDENCE+=("PHP: HIGH (Composer files found)")
fi

# React/Frontend Detection
if [[ -f "$PROJECT_DIR/package.json" ]]; then
    if grep -q "react" "$PROJECT_DIR/package.json" 2>/dev/null; then
        DETECTED_TECHS[react]=true
        TECH_CONFIDENCE+=("React: HIGH (package.json dependency)")
    fi
    if grep -q "vue" "$PROJECT_DIR/package.json" 2>/dev/null; then
        DETECTED_TECHS[vue]=true
        TECH_CONFIDENCE+=("Vue: HIGH (package.json dependency)")
    fi
    if grep -q "angular" "$PROJECT_DIR/package.json" 2>/dev/null; then
        DETECTED_TECHS[angular]=true
        TECH_CONFIDENCE+=("Angular: HIGH (package.json dependency)")
    fi
fi

# Docker Detection
if [[ -f "$PROJECT_DIR/Dockerfile" ]] || [[ -f "$PROJECT_DIR/docker-compose.yml" ]]; then
    DETECTED_TECHS[docker]=true
    TECH_CONFIDENCE+=("Docker: HIGH (Docker files found)")
fi

# Database Detection
if [[ -d "$PROJECT_DIR/migrations" ]] || [[ -f "$PROJECT_DIR/schema.sql" ]]; then
    DETECTED_TECHS[database]=true
    TECH_CONFIDENCE+=("Database: MEDIUM (migration files found)")
fi

# === DISPLAY DETECTION RESULTS ===
echo "📊 Technology Detection Results:"
for tech in "${TECH_CONFIDENCE[@]}"; do
    echo "  ✅ $tech"
done

if [[ ${#DETECTED_TECHS[@]} -eq 0 ]]; then
    echo "  ℹ️  No specific technologies detected - using generic patterns"
fi

# === BACKUP EXISTING GITIGNORE ===
if [[ -f "$GITIGNORE_FILE" ]]; then
    echo "💾 Backing up existing .gitignore..."
    cp "$GITIGNORE_FILE" "${GITIGNORE_FILE}${BACKUP_SUFFIX}"
    echo "  📁 Backup saved: ${GITIGNORE_FILE}${BACKUP_SUFFIX}"
fi

# === GENERATE COMPREHENSIVE GITIGNORE ===
echo "📝 Generating comprehensive .gitignore..."

cat > "$GITIGNORE_FILE" << 'EOF'
# === AI FRAMEWORK AUTO-GENERATED .gitignore ===
# This file is automatically generated and maintained by the AI Development Framework
# Goal: Keep your repository clean and focused on essential code
# Last updated: AUTO_UPDATE_DATE

# === FRAMEWORK SPECIFIC ===
# AI Development Framework runtime files
.ai_workflow/logs/
.ai_workflow/cache/
.ai_workflow/obsolete_files/
.ai_workflow/audit_reports/
.ai_workflow/backups/
.ai_workflow/_project_state.log
.ai_workflow/consolidation_*.md

# Generated PRPs (keep templates)
.ai_workflow/PRPs/generated/
.ai_workflow/PRPs/user_*.md
.ai_workflow/PRPs/project_*.md

# Framework testing and development files
.ai_workflow/testing/test_*.md
.ai_workflow/testing/simple_*.md
.ai_workflow/testing/basic_*.md
!.ai_workflow/testing/integration_test*.md
!.ai_workflow/testing/edge_cases_test*.md

# === TECHNOLOGY SPECIFIC ===
EOF

# Add technology-specific patterns
if [[ ${DETECTED_TECHS[nodejs]} ]]; then
    cat >> "$GITIGNORE_FILE" << 'EOF'

# Node.js
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*
lerna-debug.log*
.pnpm-debug.log*
.npm
.eslintcache
.stylelintcache
.rpt2_cache/
.rts2_cache_cjs/
.rts2_cache_es/
.rts2_cache_umd/
.nyc_output
.node_repl_history
*.tsbuildinfo
.npm
.yarn-integrity
.env.local
.env.development.local
.env.test.local
.env.production.local
EOF
fi

if [[ ${DETECTED_TECHS[python]} ]]; then
    cat >> "$GITIGNORE_FILE" << 'EOF'

# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg
MANIFEST
.env
.venv
env/
venv/
ENV/
env.bak/
venv.bak/
.spyderproject
.spyproject
.ropeproject
.coverage
.pytest_cache/
.coverage
htmlcov/
.tox/
.nox/
.cache
nosetests.xml
coverage.xml
*.cover
.hypothesis/
.pytest_cache/
EOF
fi

if [[ ${DETECTED_TECHS[java]} ]]; then
    cat >> "$GITIGNORE_FILE" << 'EOF'

# Java
*.class
*.log
*.ctxt
.mtj.tmp/
*.jar
*.war
*.nar
*.ear
*.zip
*.tar.gz
*.rar
hs_err_pid*
target/
.gradle
build/
!gradle/wrapper/gradle-wrapper.jar
!**/src/main/**/build/
!**/src/test/**/build/
.gradletasknamecache
.classpath
.project
.settings/
bin/
tmp/
*.tmp
*.bak
*.swp
*~.nib
local.properties
EOF
fi

if [[ ${DETECTED_TECHS[go]} ]]; then
    cat >> "$GITIGNORE_FILE" << 'EOF'

# Go
vendor/
*.exe
*.exe~
*.dll
*.so
*.dylib
*.test
*.out
.idea/
.vscode/
EOF
fi

if [[ ${DETECTED_TECHS[rust]} ]]; then
    cat >> "$GITIGNORE_FILE" << 'EOF'

# Rust
target/
**/*.rs.bk
Cargo.lock
EOF
fi

if [[ ${DETECTED_TECHS[php]} ]]; then
    cat >> "$GITIGNORE_FILE" << 'EOF'

# PHP
vendor/
composer.lock
.phpunit.result.cache
EOF
fi

if [[ ${DETECTED_TECHS[react]} ]]; then
    cat >> "$GITIGNORE_FILE" << 'EOF'

# React
build/
.next/
out/
.nuxt/
dist/
.storybook-static/
.docusaurus/
EOF
fi

if [[ ${DETECTED_TECHS[docker]} ]]; then
    cat >> "$GITIGNORE_FILE" << 'EOF'

# Docker
.dockerignore
docker-compose.override.yml
EOF
fi

if [[ ${DETECTED_TECHS[database]} ]]; then
    cat >> "$GITIGNORE_FILE" << 'EOF'

# Database
*.db
*.sqlite
*.sqlite3
.dbshell
EOF
fi

# Add universal patterns
cat >> "$GITIGNORE_FILE" << 'EOF'

# === UNIVERSAL PATTERNS ===
# Logs and debugging
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
lerna-debug.log*
.pnpm-debug.log*
debug.log
error.log

# Runtime data
pids
*.pid
*.seed
*.pid.lock
*.tgz
*.tar.gz

# Coverage directory used by tools like istanbul
coverage/
*.lcov
.nyc_output

# Dependency directories and files
node_modules/
jspm_packages/
bower_components/

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional stylelint cache
.stylelintcache

# Environment variables
.env
.env.local
.env.development
.env.test
.env.production
.env.staging

# IDE and Editor files
.vscode/
.idea/
*.swp
*.swo
*.kate-swp
*~
.sublime-*
.vim/

# OS generated files
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db
desktop.ini
*~
.fuse_hidden*

# Temporary files
*.tmp
*.temp
.cache/
.temp/
.tmp/
tmp/
temp/

# Backup files
*.bak
*.backup
*.orig
*.rej

# Security and credentials
*.key
*.pem
*.cert
*.crt
secrets.json
credentials.json
.secret
.secrets

# === PROJECT SPECIFIC ===
# Add your project-specific patterns below this line
# (This section is preserved during auto-updates)

EOF

# Update timestamp
sed -i "s/AUTO_UPDATE_DATE/$(date)/" "$GITIGNORE_FILE"

# === VALIDATE AND APPLY ===
echo "🔍 Validating .gitignore effectiveness..."

# Check if .gitignore is working
if git check-ignore .ai_workflow/logs/ >/dev/null 2>&1; then
    echo "✅ Framework directories properly ignored"
else
    echo "⚠️  Warning: Framework directories may not be properly ignored"
fi

# === INTEGRATION WITH GIT ===
if [[ -d "$PROJECT_DIR/.git" ]]; then
    echo "🔄 Applying .gitignore to existing repository..."
    
    # Remove previously tracked files that should now be ignored
    git rm -r --cached . >/dev/null 2>&1
    git add .gitignore
    
    # Check for files that should be untracked
    SHOULD_IGNORE=$(git ls-files --ignored --exclude-standard)
    if [[ -n "$SHOULD_IGNORE" ]]; then
        echo "📋 Files that will be untracked:"
        echo "$SHOULD_IGNORE" | sed 's/^/  - /'
        
        # Remove from tracking
        echo "$SHOULD_IGNORE" | xargs git rm --cached >/dev/null 2>&1
    fi
    
    echo "💾 Staging .gitignore changes..."
    git add .gitignore
    
    # Suggest commit
    echo "💡 Suggested next step: git commit -m 'chore: Update .gitignore with framework auto-generated patterns'"
fi

# === SETUP AUTOMATIC MAINTENANCE ===
echo "🔄 Setting up automatic .gitignore maintenance..."

# Create update script
cat > "$PROJECT_DIR/.ai_workflow/scripts/update_gitignore.sh" << 'EOF'
#!/bin/bash
# Automatic .gitignore maintenance script
# Called by framework during periodic maintenance

echo "🔄 Updating .gitignore with latest patterns..."
bash ".ai_workflow/workflows/setup/auto_gitignore_setup.md"
echo "✅ .gitignore updated successfully"
EOF

chmod +x "$PROJECT_DIR/.ai_workflow/scripts/update_gitignore.sh"

# === FINAL REPORT ===
echo ""
echo "🎉 Auto GitIgnore Setup Complete!"
echo "================================="
echo "✅ Technologies detected: ${#DETECTED_TECHS[@]}"
echo "✅ .gitignore patterns: Comprehensive coverage"
echo "✅ Framework integration: Automatic maintenance"
echo "✅ Repository cleanliness: Zero-friction guaranteed"
echo ""
echo "📊 Benefits for user:"
echo "  - Automatic repository cleanliness"
echo "  - Technology-specific patterns"
echo "  - Framework files automatically ignored"
echo "  - No manual maintenance required"
echo ""
echo "🔄 Automatic maintenance:"
echo "  - Updates during project setup"
echo "  - Periodic pattern updates"
echo "  - Technology detection refresh"
echo "  - Framework compatibility maintenance"
echo ""
echo "💡 Manual override:"
echo "  - Add project-specific patterns to 'PROJECT SPECIFIC' section"
echo "  - Framework will preserve your custom patterns during updates"
```

## Integration Points

### 1. Project Setup Integration
- Automatically called during `./ai-dev setup`
- Runs technology detection and .gitignore generation
- Zero user intervention required

### 2. Periodic Maintenance
- Updates .gitignore during framework updates
- Refreshes technology detection
- Maintains pattern compatibility

### 3. User Override Support
- Preserves user-specific patterns
- Allows manual customization
- Maintains framework automation

## Technology Detection Matrix

| Technology | Detection Files | Confidence | Patterns Added |
|------------|----------------|------------|----------------|
| Node.js | package.json, yarn.lock | HIGH | node_modules/, *.log |
| Python | requirements.txt, setup.py | HIGH | __pycache__/, *.pyc |
| Java | pom.xml, build.gradle | HIGH | target/, *.class |
| Go | go.mod, go.sum | HIGH | vendor/, *.exe |
| Rust | Cargo.toml | HIGH | target/, *.rs.bk |
| PHP | composer.json | HIGH | vendor/, .phpunit |
| React | package.json + react dep | HIGH | build/, .next/ |
| Docker | Dockerfile | HIGH | .dockerignore |

## User Experience
- **Zero Configuration**: Works automatically
- **Technology Aware**: Adapts to project stack
- **Maintenance Free**: Updates automatically
- **Customizable**: Supports user overrides
- **Framework Integrated**: Seamless with AI workflows